#CVE-2018-15664

CVE-2018-15664 was discovered by Aleksa Sarai. A function called FollowSymlinkInScope is vulnerable to TOCTOU(time to check to time of use) attach. The FollowSymlinkInScope takes a path and resolves it as though the process was inside the container. In case of docker cp, attacker can use the time after the path sanitisation/resolution but before the operation on it to create a symbolic link, then a user could end up resolving the symlink link on the host as root. As a result one can get read and write access to any file on the host.

Creates a docker image with a binary that makes a system call renameat2(). It exchanges symbolic link to “/” with an empty directory in a loop in attempt to hit race condition. In write_script.sh a user tries to copy a file to a path containing the swapped symlink in the container. If it successfully hits the race condition host file system is overwritten.

Attached scripts are taken from https://bugzilla.suse.com/show_bug.cgi?id=1096726#c17 . Code is changed to remove errors and enhance functionality.
